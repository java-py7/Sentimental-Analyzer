<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Sentiment Analyzer</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.1/css/all.css"
          integrity="sha384-vp86vTRFVJgpjF9jiIGPEEqYqlDwgyBgEF109VFjmqGmIY/Y4HV4d3Gp2irVfcrp" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* =============== STYLES =============== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #8454b3 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        /* =============== PRELOADER =============== */
        .preloader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .preloader-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .preloader-loaders {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .loader {
            --path: white;
            --dot: #f40af0;
            --duration: 3s;
            width: 44px;
            height: 44px;
            position: relative;
        }

        .loader:before {
            content: "";
            width: 6px;
            height: 6px;
            border-radius: 50%;
            position: absolute;
            display: block;
            background: var(--dot);
            top: 37px;
            left: 19px;
            transform: translate(-18px, -18px);
            animation: dotRect var(--duration) cubic-bezier(0.785, 0.135, 0.15, 0.86) infinite;
        }

        .loader svg {
            display: block;
            width: 100%;
            height: 100%;
        }

        .loader svg rect, .loader svg polygon, .loader svg circle {
            fill: none;
            stroke: var(--path);
            stroke-width: 10px;
            stroke-linejoin: round;
            stroke-linecap: round;
        }

        .loader svg polygon {
            stroke-dasharray: 145 76 145 76;
            stroke-dashoffset: 0;
            animation: pathTriangle var(--duration) cubic-bezier(0.785, 0.135, 0.15, 0.86) infinite;
        }

        .loader svg rect {
            stroke-dasharray: 192 64 192 64;
            stroke-dashoffset: 0;
            animation: pathRect 3s cubic-bezier(0.785, 0.135, 0.15, 0.86) infinite;
        }

        .loader svg circle {
            stroke-dasharray: 150 50 150 50;
            stroke-dashoffset: 75;
            animation: pathCircle var(--duration) cubic-bezier(0.785, 0.135, 0.15, 0.86) infinite;
        }

        .loader.triangle {
            width: 48px;
        }

        .loader.triangle:before {
            left: 21px;
            transform: translate(-10px, -18px);
            animation: dotTriangle var(--duration) cubic-bezier(0.785, 0.135, 0.15, 0.86) infinite;
        }

        .preloader-text {
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            text-align: center;
        }

        .preloader-subtext {
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            text-align: center;
        }

        /* Geometric Loader Keyframes */
        @keyframes pathTriangle {
            33% { stroke-dashoffset: 74; }
            66% { stroke-dashoffset: 147; }
            100% { stroke-dashoffset: 221; }
        }

        @keyframes dotTriangle {
            33% { transform: translate(0, 0); }
            66% { transform: translate(10px, -18px); }
            100% { transform: translate(-10px, -18px); }
        }

        @keyframes pathRect {
            25% { stroke-dashoffset: 64; }
            50% { stroke-dashoffset: 128; }
            75% { stroke-dashoffset: 192; }
            100% { stroke-dashoffset: 256; }
        }

        @keyframes dotRect {
            25% { transform: translate(0, 0); }
            50% { transform: translate(18px, -18px); }
            75% { transform: translate(0, -36px); }
            100% { transform: translate(-18px, -18px); }
        }

        @keyframes pathCircle {
            25% { stroke-dashoffset: 125; }
            50% { stroke-dashoffset: 175; }
            75% { stroke-dashoffset: 225; }
            100% { stroke-dashoffset: 275; }
        }

 /* =============== MAIN CONTENT =============== */

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .app-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .app-title {
            font-size: 36px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }


        .input-section {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .url-input {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            width: 400px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            outline: none;
            transition: all 0.3s ease;
        }

        .url-input:hover, .url-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
        }

        .comment-limit-select {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            outline: none;
            transition: all 0.3s ease;
            cursor: pointer;
            color: #333;
            font-weight: 500;
        }

        .comment-limit-select:hover, .comment-limit-select:focus {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
            background: rgba(255, 255, 255, 1);
        }

        .analyze-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        /* =============== NAVIGATION TAB =============== */
        .tab-navigation {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 10px;
            display: flex;
            gap: 10px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .tab-button {
            padding: 12px 25px;
            border: none;
            border-radius: 15px;
            background: transparent;
            color: #666;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .tab-button:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .tab-content {
            display: none;
            padding-bottom: 120px;
        }

        .tab-content.active {
            display: block;
        }

        /* =============== RESULTS STYLES =============== */
        .results-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .visualization-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .visualization-card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .sentiment-summary {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .sentiment-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            transition: transform 0.3s ease;
        }

        .stat-item:hover {
            transform: scale(1.05);
        }

        .stat-positive { background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; }
        .stat-negative { background: linear-gradient(135deg, #d33535, #f5576c); color: white; }
        .stat-neutral { background: linear-gradient(135deg, #0ef650, #43e97b); color: white; }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            font-weight: 500;
            opacity: 0.9;
        }

        /* =============== HISTORY TAB =============== */
        .history-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .history-title {
            font-size: 32px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .clear-all-btn {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin: 0 auto 30px;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(245, 87, 108, 0.3);
        }

        .clear-all-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(245, 87, 108, 0.4);
        }

        .history-entry {
            background: white;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .history-entry:hover {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
        }

        .history-header {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            transition: background 0.3s ease;
        }

        .history-header:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .history-info {
            flex: 1;
        }

        .history-id {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 5px;
        }

        .history-meta {
            font-size: 14px;
            color: #666;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .history-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .expand-icon {
            width: 24px;
            height: 24px;
            border: 2px solid #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #667eea;
            transition: all 0.3s ease;
        }

        .history-entry.expanded .expand-icon {
            transform: rotate(180deg);
            background: #667eea;
            color: white;
        }

        .delete-btn {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .history-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease, padding 0.3s ease;
            padding: 0 25px;
        }

        .history-entry.expanded .history-content {
            max-height: 1000px;
            padding: 25px;
        }

        .history-details {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .detail-section {
            background: rgba(102, 126, 234, 0.05);
            padding: 20px;
            border-radius: 12px;
        }

        .detail-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .detail-item {
            margin-bottom: 10px;
            font-size: 14px;
        }

        .detail-label {
            font-weight: 600;
            color: #555;
        }

        .detail-value {
            color: #777;
        }

        .visualizations-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .viz-preview {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            transition: transform 0.3s ease;
        }

        .viz-preview:hover {
            transform: scale(1.02);
        }

        .viz-preview img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .viz-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        /* =============== COMMENTS STYLES =============== */
        .comments-section {
            margin-top: 30px;
        }

        .comments-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }

        .comment-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 20px;
            transition: transform 0.2s ease;
        }

        .comment-item:hover {
            transform: translateX(5px);
        }

        .comment-text {
            flex: 1;
            font-size: 15px;
            line-height: 1.5;
            color: #444;
        }

        .sentiment-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }

        .badge-positive { background: #4facfe; color: white; }
        .badge-negative { background: #f5576c; color: white; }
        .badge-neutral { background: #43e97b; color: white; }

        /* =============== ERROR STYLES =============== */
        .error-message {
            background: linear-gradient(135deg, #ea1717, #f5576c);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
            font-weight: 600;
        }

        /* =============== RESPONSIVE DESIGN  =============== */
        @media (max-width: 768px) {
            .main-container { padding: 10px; }
            .app-title { font-size: 28px; }
            .url-input { width: 100%; max-width: 350px; }
            .results-grid { grid-template-columns: 1fr; }
            .history-details { grid-template-columns: 1fr; }
            .visualizations-grid { grid-template-columns: 1fr; }
            .input-section { flex-direction: column; }
        }

        /* =============== SCROLL IMPROVEMENTS =============== */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8, #6b46c1);
        }

        /* =============== LOADING STATES =============== */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .pulse {
            animation: pulse-effect 2s ease-in-out infinite;
        }

        @keyframes pulse-effect {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>

</head>
<body>

<!-- =============== PRELOADER =============== -->
<div id="preloader" class="preloader-overlay">
    <div class="preloader-loaders">
        <div class="loader">
            <svg viewBox="0 0 80 80">
                <circle cx="40" cy="40" r="32"></circle>
            </svg>
        </div>

        <div class="loader triangle">
            <svg viewBox="0 0 86 80">
                <polygon points="43 8 79 72 7 72"></polygon>
            </svg>
        </div>

        <div class="loader">
            <svg viewBox="0 0 80 80">
                <rect x="8" y="8" width="64" height="64"></rect>
            </svg>
        </div>
    </div>

    <div class="preloader-text" id="preloader-text">Analyzing Comments...</div>
    <div class="preloader-subtext" id="preloader-subtext">Fetching YouTube data and processing sentiment analysis</div>
</div>

 <!-- =============== MAIN CONTENT =============== -->

<div class="main-container">
    <!-- =============== HOME TAB =============== -->
    <div id="home" class="tab-content active">
        <div class="app-header">
            <h1 class="app-title">YouTube Sentiment Analyzer</h1>


            <div class="input-section">
                <form action="/analyze" method="POST" style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap; justify-content: center;">
                    <input type="text" class="url-input" name="video_url" placeholder="Enter YouTube Video URL" required>
                    <select class="comment-limit-select" name="max_comments">
                        <option value="50">50 Comments</option>
                        <option value="100">100 Comments</option>
                        <option value="200" selected>200 Comments</option>
                        <option value="500">500 Comments</option>
                        <option value="1000">1000 Comments</option>
                        <option value="all">All Comments</option>
                    </select>
                    <button type="submit" class="analyze-btn">
                        <i class="fas fa-search"></i> Analyze Video
                    </button>
                </form>
            </div>
        </div>

        {% if error %}
        <div class="error-message">
            <i class="fas fa-exclamation-triangle"></i> {{ error }}
        </div>
        {% endif %}

        {% if analyzed %}
        <div class="results-container">
            <h2 style="font-size: 24px; font-weight: 600; margin-bottom: 25px; color: #333;">
                <i class="fas fa-chart-line"></i> Analysis Results for:
                <a href="{{ video_url }}" target="_blank" style="color: #667eea; text-decoration: none;">{{ video_url }}</a>
            </h2>
            <p style="text-align: center; color: #666; margin-bottom: 20px; font-size: 16px;">
                <i class="fas fa-info-circle"></i> Analyzed {{ sentiments|length }} comments
                {% if max_comments_requested and max_comments_requested != 'all' %}
                    (Requested: {{ max_comments_requested }} max)
                {% elif max_comments_requested == 'all' %}
                    (Requested: All available comments)
                {% endif %}
            </p>

            <!-- Sentiment Summary -->
            <div class="sentiment-summary">
                <h3 class="card-title"><i class="fas fa-chart-pie"></i> Sentiment Summary</h3>
                <div class="sentiment-stats">
                    <div class="stat-item stat-positive">
                        <div class="stat-number">{{ sentiment_counts.get('Positive', 0) }}</div>
                        <div class="stat-label">Positive</div>
                    </div>
                    <div class="stat-item stat-negative">
                        <div class="stat-number">{{ sentiment_counts.get('Negative', 0) }}</div>
                        <div class="stat-label">Negative</div>
                    </div>
                    <div class="stat-item stat-neutral">
                        <div class="stat-number">{{ sentiment_counts.get('Neutral', 0) }}</div>
                        <div class="stat-label">Neutral</div>
                    </div>
                </div>
            </div>

            <!-- Visualizations -->
            <div class="results-grid">
                <div class="visualization-card">
                    <h3 class="card-title"><i class="fas fa-cloud"></i> Word Cloud</h3>
                    <img src="{{ url_for('static', filename='wordcloud_' + analysis_id + '.png') }}"
                         alt="Word Cloud" style="width: 100%; border-radius: 10px;">
                </div>

                <div class="visualization-card">
                    <h3 class="card-title"><i class="fas fa-chart-bar"></i> Sentiment Distribution</h3>
                    <img src="{{ url_for('static', filename='bar_chart_' + analysis_id + '.png') }}"
                         alt="Bar Chart" style="width: 100%; border-radius: 10px;">
                </div>
            </div>

            <!-- Comments Section -->
            <div class="comments-section">
                <h3 class="comments-title"><i class="fas fa-comments"></i> Analyzed Comments</h3>
                <div class="comments-list">
                    {% for sentiment, comment in sentiments %}
                    <div class="comment-item">
                        <div class="comment-text">{{ comment }}</div>
                        <div class="sentiment-badge badge-{{ sentiment.lower() }}">
                            {{ sentiment }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- =============== HISTORY TAB =============== -->
    <div id="history" class="tab-content">
        <div class="history-container">
            <h2 class="history-title"><i class="fas fa-history"></i> Analysis History</h2>

            {% if history %}
            <button class="clear-all-btn" onclick="confirmClearAll()">
                <i class="fas fa-trash"></i> Clear All History
            </button>

            <div class="history-list">
                {% for entry in history %}
                <div class="history-entry" id="history-{{ entry.id }}">
                    <div class="history-header" onclick="toggleHistory('{{ entry.id }}')">
                        <div class="history-info">
                            <div class="history-id">Analysis #{{ entry.id }}</div>
                            <div class="history-meta">
                                <span><i class="fas fa-calendar"></i> {{ entry.timestamp }}</span>
                                <span><i class="fas fa-video"></i> {{ entry.video_id }}</span>
                                <span><i class="fas fa-comments"></i> {{ entry.total_comments }} comments</span>
                            </div>
                        </div>
                        <div class="history-controls">
                            <button class="delete-btn" onclick="event.stopPropagation(); confirmDelete('{{ entry.id }}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                            <div class="expand-icon">
                                <i class="fas fa-chevron-down"></i>
                            </div>
                        </div>
                    </div>

                    <div class="history-content">
                        <div class="history-details">
                            <div class="detail-section">
                                <h4 class="detail-title">Video Information</h4>
                                <div class="detail-item">
                                    <span class="detail-label">URL:</span>
                                    <a href="{{ entry.video_url }}" target="_blank" style="color: #667eea;">{{ entry.video_url }}</a>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Video ID:</span>
                                    <span class="detail-value">{{ entry.video_id }}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Comments Analyzed:</span>
                                    <span class="detail-value">{{ entry.total_comments }}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">Max Requested:</span>
                                    <span class="detail-value">{{ entry.max_comments_requested or 'N/A' }}</span>
                                </div>

                                <h4 class="detail-title" style="margin-top: 20px;">Sentiment Breakdown</h4>
                                <div class="detail-item">
                                    <span class="detail-label" style="color: #4facfe;">Positive:</span>
                                    <span class="detail-value">{{ entry.sentiment_counts.get('Positive', 0) }}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label" style="color: #f5576c;">Negative:</span>
                                    <span class="detail-value">{{ entry.sentiment_counts.get('Negative', 0) }}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label" style="color: #43e97b;">Neutral:</span>
                                    <span class="detail-value">{{ entry.sentiment_counts.get('Neutral', 0) }}</span>
                                </div>
                            </div>

                            <div class="detail-section">
                                <h4 class="detail-title">Generated Visualizations</h4>
                                <div class="visualizations-grid">
                                    <div class="viz-preview">
                                        <div class="viz-title">Word Cloud</div>
                                        <img src="{{ url_for('static', filename=entry.wordcloud_file) }}" alt="Word Cloud">
                                    </div>
                                    <div class="viz-preview">
                                        <div class="viz-title">Sentiment Chart</div>
                                        <img src="{{ url_for('static', filename=entry.barchart_file) }}" alt="Bar Chart">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            {% else %}
            <div style="text-align: center; padding: 60px; color: #666;">
                <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                <h3 style="margin-bottom: 10px;">No Analysis History</h3>
                <p>Perform some analyses to see them here!</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- =============== NAVIGATION TABS =============== -->
<div class="tab-navigation">
    <button class="tab-button active" onclick="openTab('home')">
        <i class="fas fa-home"></i> Home
    </button>
    <button class="tab-button" onclick="openTab('history')">
        <i class="fas fa-history"></i> History
    </button>
</div>

<script>
// =============== PRELOADER FUNCTIONS ===============
const PRELOADER_CONFIG = {
    minimumShowTime: 5000,
    messageChangeInterval: 1000
};

const PRELOADER_MESSAGES = [
    { text: "Initializing Analysis...", subtext: "Connecting to YouTube API" },
    { text: "Fetching Comments...", subtext: "Retrieving video comment data" },
    { text: "Processing Data...", subtext: "Cleaning and preprocessing comments" },
    { text: "Running AI Analysis...", subtext: "Applying advanced sentiment algorithms" },
    { text: "Generating Visualizations...", subtext: "Creating charts and word clouds" }
];

function showPreloader() {
    const preloader = document.getElementById('preloader');
    const textElement = document.getElementById('preloader-text');
    const subtextElement = document.getElementById('preloader-subtext');

    preloader.classList.add('active');
    document.body.style.overflow = 'hidden';

    let messageIndex = 0;

    // Start with first message
    if (PRELOADER_MESSAGES[0]) {
        textElement.textContent = PRELOADER_MESSAGES[0].text;
        subtextElement.textContent = PRELOADER_MESSAGES[0].subtext;
        messageIndex = 1;
    }

    // Change messages during preloader
    const messageInterval = setInterval(() => {
        if (messageIndex < PRELOADER_MESSAGES.length) {
            textElement.textContent = PRELOADER_MESSAGES[messageIndex].text;
            subtextElement.textContent = PRELOADER_MESSAGES[messageIndex].subtext;
            messageIndex++;
        }
    }, PRELOADER_CONFIG.messageChangeInterval);

    return messageInterval;
}

function hidePreloader() {
    const preloader = document.getElementById('preloader');
    preloader.classList.remove('active');
    document.body.style.overflow = '';
}

// =============== FORM SUBMISSION ===============
document.addEventListener('DOMContentLoaded', function() {
    document.addEventListener('submit', function(e) {
        if (e.target && e.target.matches('form[action="/analyze"]')) {
            e.preventDefault();

            const form = e.target;
            const formData = new FormData(form);
            const videoUrl = formData.get('video_url');

            if (!videoUrl) {
                alert('Please enter a YouTube URL');
                return;
            }

            // Show new preloader
            const messageInterval = showPreloader();

            // Submit form
            fetch('/analyze', {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(html => {
                setTimeout(() => {
                    clearInterval(messageInterval);
                    hidePreloader();

                    // Update content
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newHomeContent = doc.getElementById('home');

                    if (newHomeContent) {
                        document.getElementById('home').innerHTML = newHomeContent.innerHTML;
                    }

                    openTab('home');

                    // Clear form
                    const currentForm = document.querySelector('form[action="/analyze"]');
                    if (currentForm) {
                        const input = currentForm.querySelector('input[name="video_url"]');
                        if (input) input.value = '';
                    }
                }, PRELOADER_CONFIG.minimumShowTime);
            })
            .catch(error => {
                console.error('Error:', error);
                clearInterval(messageInterval);
                hidePreloader();
                alert('An error occurred during analysis. Please try again.');
            });
        }
    });
});

// =============== TAB FUNCTIONALITY ===============
function openTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(tb => tb.classList.remove('active'));

    document.getElementById(tabName).classList.add('active');
    document.querySelector(`.tab-button[onclick="openTab('${tabName}')"]`).classList.add('active');

    if (tabName === 'history') {
        loadHistory();
    }
}

// =============== COLLAPSIBLE HISTORY FUNCTIONALITY ===============
function toggleHistory(entryId) {
    const historyEntry = document.getElementById(`history-${entryId}`);
    if (historyEntry) {
        historyEntry.classList.toggle('expanded');
    }
}

// =============== DELETE FUNCTIONALITY ===============
function confirmDelete(analysisId) {
    if (confirm('Are you sure you want to delete this analysis? This action cannot be undone.')) {
        deleteAnalysis(analysisId);
    }
}

function confirmClearAll() {
    if (confirm('Are you sure you want to clear ALL history? This will delete all analyses and cannot be undone.')) {
        clearAllHistory();
    }
}

function deleteAnalysis(analysisId) {
    fetch(`/delete_history/${analysisId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Analysis deleted successfully!');
            loadHistory();
        } else {
            alert('Failed to delete analysis: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while deleting the analysis.');
    });
}

function clearAllHistory() {
    fetch('/clear_all_history', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('All history cleared successfully!');
            loadHistory();
        } else {
            alert('Failed to clear history: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while clearing history.');
    });
}

function loadHistory() {
    fetch('/history')
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const historyContent = doc.getElementById('history').innerHTML;
            document.getElementById('history').innerHTML = historyContent;
        })
        .catch(error => {
            console.error('Error loading history:', error);
        });
}
</script>

</body>
</html>
